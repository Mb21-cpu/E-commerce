{% extends 'base.html' %}

{% block title %}Detalle de Orden #{{ order.id }}{% endblock %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">
    <h1 class="text-3xl font-extrabold text-gray-800 mb-6 border-b pb-2">
        Detalle de Orden #{{ order.id }}
    </h1>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Columna de Detalles de la Orden -->
        <div class="lg:col-span-1 bg-white shadow-xl rounded-xl p-6 h-fit">
            <h2 class="text-xl font-bold text-indigo-700 mb-4 border-b pb-2">Resumen</h2>
            
            <div class="space-y-3 text-sm">
                <p class="flex justify-between">
                    <span class="font-medium text-gray-600">Comprador:</span>
                    <span class="text-gray-900">{{ order.customer.username }}</span>
                </p>
                <p class="flex justify-between">
                    <span class="font-medium text-gray-600">Email:</span>
                    <span class="text-gray-900">{{ order.customer_email }}</span>
                </p>
                <p class="flex justify-between">
                    <span class="font-medium text-gray-600">Fecha de Compra:</span>
                    <span class="text-gray-900">{{ order.created|date:"d M Y, H:i" }}</span>
                </p>
                <p class="flex justify-between">
                    <span class="font-medium text-gray-600">ID de Sesión Stripe:</span>
                    <span class="text-gray-900 break-all text-xs">{{ order.stripe_checkout_session_id|truncatechars:20 }}...</span>
                </p>
            </div>
            
            <h2 class="text-xl font-bold text-indigo-700 mb-4 mt-6 border-b pb-2">Dirección de Envío</h2>
            <p class="text-gray-700 whitespace-pre-line">{{ order.shipping_address }}</p>
        </div>

        <!-- Columna de Artículos y Total -->
        <div class="lg:col-span-2 bg-white shadow-xl rounded-xl p-6">
            <h2 class="text-xl font-bold text-indigo-700 mb-4 border-b pb-2">Productos Comprados</h2>
            
            <div class="space-y-4">
                {% for item in order.items.all %}
                <div class="flex items-center justify-between p-4 border rounded-lg bg-indigo-50/50">
                    <div class="flex-1 min-w-0">
                        <p class="text-lg font-semibold text-gray-800">{{ item.product.name }}</p>
                        <p class="text-sm text-gray-500">
                            Precio Unitario: ${{ item.price|floatformat:2 }}
                        </p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-base font-medium text-gray-700">x{{ item.quantity }}</span>
                        <span class="text-lg font-bold text-green-600 min-w-[80px] text-right">
                            ${{ item.get_total_price|floatformat:2 }}
                        </span>
                    </div>
                </div>
                {% empty %}
                <p class="text-gray-600">No se encontraron artículos para esta orden.</p>
                {% endfor %}
            </div>

            <!-- Resumen de Totales -->
            <div class="mt-8 pt-4 border-t-2 border-indigo-200">
                <div class="space-y-2 text-base">
                    <p class="flex justify-between font-medium text-gray-700">
                        <span>Subtotal:</span>
                        <span>${{ order.get_order_subtotal|floatformat:2 }}</span>
                    </p>
                    <p class="flex justify-between font-medium text-gray-700">
                        <span>Costo de Envío:</span>
                        <span>$5.00</span> {# Asumimos una tarifa fija de $5.00 #}
                    </p>
                    <p class="flex justify-between text-xl font-bold text-green-700 pt-2 border-t mt-4">
                        <span>Total Pagado:</span>
                        <span>${{ order.total_paid|floatformat:2 }}</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mt-8 text-center">
        <a href="{% url 'purchase_history' %}" class="inline-flex items-center px-6 py-3 border border-transparent text-sm font-medium rounded-full shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
            Volver al Historial de Compras
        </a>
    </div>

</div>

<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'indigo': {
                        50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 
                        500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 
                        800: '#3730a3'
                    },
                    'green': { 600: '#059669', 700: '#047857' }
                }
            }
        }
    }
</script>
{% endblock %}
